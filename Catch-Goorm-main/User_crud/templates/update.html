{% extends 'base.html' %}
{% load static %}  <!-- static íƒœê·¸ ë¡œë“œ -->

{% block title %}Update Information{% endblock %}

{% block content %}
    <h2>Update Your Information</h2>
    <div class="profile-container">
        {% if user.avatar %}
            <img id="profileImage" src="{{ user.avatar.url }}" alt="Profile image of {{ user.username }}" class="profile-image" onclick="triggerFileInput()">
        {% else %}
            <img id="profileImage" src="{% static 'images/default_profile.png' %}" alt="Default profile image" class="profile-image" onclick="triggerFileInput()">
        {% endif %}
        <br>
        <div style="color: rgba(150, 150, 150, 0.514);">ğŸ”§ click to change</div>
    </div>

    <form name="updateForm" method="post" enctype="multipart/form-data" onsubmit="return validateForm()">
        {% csrf_token %}
        
        <!-- ìˆ¨ê²¨ì§„ íŒŒì¼ ì…ë ¥ í•„ë“œ -->
        <input type="file" id="profileInput" name="profile_image" class="input-field" accept="image/*" style="display: none;" onchange="previewImage(event)">

        <label for="username">User ID:</label>
        <input type="text" name="username" class="input-field" value="{{ user.username }}" disabled>

        <label for="first_name">Name:</label>
        <input type="text" name="first_name" class="input-field" value="{{ user.first_name }}" required>

        <label for="password">Password (leave blank if you don't want to change it):</label>
        <input type="password" name="password" class="input-field">

        <button type="submit" class="btn">Update</button>
    </form>

    <a href="{% url 'home' %}">Back to Home</a>

    <script>
        // ì´ë¯¸ì§€ í´ë¦­ ì‹œ íŒŒì¼ ì—…ë¡œë“œ ì°½ì„ ì—´ê¸° ìœ„í•œ í•¨ìˆ˜
        function triggerFileInput() {
            document.getElementById('profileInput').click();
        }

        // ì„ íƒí•œ ì´ë¯¸ì§€ë¥¼ ë¯¸ë¦¬ë³´ê¸°ë¡œ ë³´ì—¬ì£¼ëŠ” í•¨ìˆ˜
        function previewImage(event) {
            const reader = new FileReader();
            const profileImage = document.getElementById('profileImage');

            reader.onload = function() {
                if (reader.readyState === 2) {
                    profileImage.src = reader.result;  // ì„ íƒí•œ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°
                }
            }

            reader.readAsDataURL(event.target.files[0]);  // íŒŒì¼ ì½ê¸°
        }

        function validateForm() {
            const firstName = document.forms["updateForm"]["first_name"].value;
            const password = document.forms["updateForm"]["password"].value;

            const nameRegex = /^[a-zA-Zê°€-í£]+$/;
            const passwordRegex = /^(?=.*[a-zA-Z])(?=.*[0-9]).{8,}$/;

            if (!nameRegex.test(firstName)) {
                alert("ì´ë¦„ì€ í•œê¸€ ë˜ëŠ” ì˜ì–´ë¡œë§Œ ì…ë ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
                return false;
            }

            if (password && !passwordRegex.test(password)) {
                alert("ë¹„ë°€ë²ˆí˜¸ëŠ” 8ìë¦¬ ì´ìƒì´ë©°, ì˜ë¬¸ìì™€ ìˆ«ìë¥¼ ëª¨ë‘ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.");
                return false;
            }

            return true;
        }
    </script>
{% endblock %}